services:
  db:
    image: mcr.microsoft.com/mssql/server:2022-latest
    environment:
      ACCEPT_EULA: "Y"
      SA_PASSWORD: "Altairis12345!"
    ports:
      - "1433:1433"
    volumes:
      - altairis_mssql:/var/opt/mssql

  backend:
    build:
      context: ./backend/Altairis.Backoffice/Altairis.Api
      dockerfile: Dockerfile
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      # Sincronizado con el nombre del servicio 'db'
      ConnectionStrings__Default: "Server=db,1433;Database=AltairisDb;User Id=sa;Password=Altairis12345!;Encrypt=False;TrustServerCertificate=True"
    ports:
      - "8080:8080"
    depends_on:
      - db

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    environment:
      # Sincronizado con el nombre del servicio 'backend' para el proxy interno
      API_INTERNAL_BASE: "http://backend:8080"
    ports:
      - "3000:3000"
    depends_on:
      - backend

volumes:
  altairis_mssql:
